<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server List Decoder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #output {
            white-space: pre-wrap;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Server List Decoder</h1>
    <button onclick="fetchAndDecode()">Fetch and Decode Servers</button>
    <div id="output"></div>

    <!-- Include CryptoJS from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // Display current date and time
        const now = new Date();
        document.getElementById('output').textContent = now.toISOString().replace(/T/, '-').replace(/Z/, '').split('.')[0] + '\n\n';

        // Constants from the Python script
        const apiUrl = 'http://api.skrapp.net/api/serverlist';
        const headers = {
            'accept': '/',
            'accept-language': 'zh-Hans-CN;q=1, en-CN;q=0.9',
            'appversion': '1.3.1',
            'user-agent': 'SkrKK/1.3.1 (iPhone; iOS 13.5; Scale/2.00)',
            'content-type': 'application/x-www-form-urlencoded',
            'Cookie': 'PHPSESSID=fnffo1ivhvt0ouo6ebqn86a0d4'
        };
        const postData = 'data=4265a9c353cd8624fd2bc7b5d75d2f18b1b5e66ccd37e2dfa628bcb8f73db2f14ba98bc6a1d8d0d1c7ff1ef0823b11264d0addaba2bd6a30bdefe06f4ba994ed';
        const key = CryptoJS.enc.Utf8.parse('65151f8d966bf596'); // 16-byte key
        const iv = CryptoJS.enc.Utf8.parse('88ca0f0ea1ecf975');  // 16-byte IV

        // Decryption function (equivalent to Python's f())
        function decryptData(encryptedHex) {
            const encryptedBytes = CryptoJS.enc.Hex.parse(encryptedHex);
            const decipher = CryptoJS.AES.decrypt(
                { ciphertext: encryptedBytes },
                key,
                { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
            );
            return decipher.toString(CryptoJS.enc.Utf8);
        }

        // Base64 encoding function
        function base64Encode(str) {
            return btoa(str);
        }

        // Main function to fetch and decode
        async function fetchAndDecode() {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: headers,
                    body: postData
                });

                if (response.ok) {
                    const encryptedText = await response.text();
                    const encryptedHex = encryptedText.trim();
                    const decryptedData = decryptData(encryptedHex);
                    const serverData = JSON.parse(decryptedData);

                    let output = document.getElementById('output').textContent;
                    serverData.data.forEach(server => {
                        const ssString = `aes-256-cfb:${server.password}@${server.ip}:${server.port}`;
                        const encoded = base64Encode(ssString);
                        const result = `ss://${encoded}#${server.title}`;
                        output += result + '\n';
                    });
                    document.getElementById('output').textContent = output;
                } else {
                    document.getElementById('output').textContent += 'Failed to fetch data: ' + response.status + '\n';
                }
            } catch (error) {
                document.getElementById('output').textContent += 'Error: ' + error.message + '\n';
            }
        }
    </script>
</body>
</html>
