<!DOCTYPE html>
<html>
<head>
    <title>Server List</title>
    <meta charset="UTF-8">
</head>
<body>
    <pre id="output">Loading...</pre>
    <script>
        async function decryptAES128CBC(ciphertext, key, iv) {
            try {
                const encryptedBytes = new Uint8Array(
                    ciphertext.match(/.{1,2}/g).map(byte => parseInt(byte, 16))
                );
                const keyBytes = new TextEncoder().encode(key);
                const ivBytes = new TextEncoder().encode(iv);
                
                const cryptoKey = await crypto.subtle.importKey(
                    "raw",
                    keyBytes,
                    { name: "AES-CBC" },
                    false,
                    ["decrypt"]
                );

                const decrypted = await crypto.subtle.decrypt(
                    { name: "AES-CBC", iv: ivBytes },
                    cryptoKey,
                    encryptedBytes
                );

                const decryptedBytes = new Uint8Array(decrypted);
                const paddingLength = decryptedBytes[decryptedBytes.length - 1];
                
                return paddingLength > 0 && paddingLength <= 16 
                    ? decryptedBytes.slice(0, -paddingLength) 
                    : decryptedBytes;
            } catch (err) {
                console.error('Decryption error:', err);
                return null;
            }
        }

        async function fetchData() {
            const config = {
                url: 'https://api.skrapp.net/api/serverlist',
                headers: {
                    'accept': '/',
                    'accept-language': 'zh-Hans-CN;q=1, en-CN;q=0.9',
                    'appversion': '1.3.1',
                    'user-agent': 'SkrKK/1.3.1 (iPhone; iOS 13.5; Scale/2.00)',
                    'content-type': 'application/x-www-form-urlencoded',
                    'Cookie': 'PHPSESSID=fnffo1ivhvt0ouo6ebqn86a0d4'
                },
                body: 'data=4265a9c353cd8624fd2bc7b5d75d2f18b1b5e66ccd37e2dfa628bcb8f73db2f14ba98bc6a1d8d0d1c7ff1ef0823b11264d0addaba2bd6a30bdefe06f4ba994ed',
                key: '65151f8d966bf596',
                iv: '88ca0f0ea1ecf975'
            };

            try {
                const response = await fetch(config.url, {
                    method: 'POST',
                    headers: config.headers,
                    body: config.body
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const encryptedData = (await response.text()).trim();
                const decryptedBytes = await decryptAES128CBC(encryptedData, config.key, config.iv);
                
                if (!decryptedBytes) throw new Error('Decryption failed');

                const decryptedStr = new TextDecoder().decode(decryptedBytes);
                const parsedData = JSON.parse(decryptedStr);
                
                // Generate timestamp
                const now = new Date();
                const timestamp = [
                    now.getUTCFullYear(),
                    String(now.getUTCMonth() + 1).padStart(2, '0'),
                    String(now.getUTCDate()).padStart(2, '0'),
                    String(now.getUTCHours()).padStart(2, '0'),
                    String(now.getUTCMinutes()).padStart(2, '0'),
                    String(now.getUTCSeconds()).padStart(2, '0')
                ].join('-');

                // Build result
                let result = `${timestamp}\n`;
                for (const server of parsedData.data) {
                    const authString = `aes-256-cfb:${server.password}@${server.ip}:${server.port}`;
                    result += `ss://${btoa(authString)}#${server.title}\n`;
                }

                document.getElementById('output').textContent = result.trim();
            } catch (error) {
                document.getElementById('output').textContent = `Error: ${error.message}`;
                console.error('Fetch error:', error);
            }
        }

        // Start fetching when page loads
        window.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>
</html>
